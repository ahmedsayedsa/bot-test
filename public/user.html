<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    .card { background: white; padding: 20px; border-radius: 10px; max-width: 500px; margin: auto; }
    h1 { text-align: center; color: #333; }
    input, button { width: 100%; padding: 10px; margin: 5px 0; }
    .qr { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h1>
    <div id="loginForm">
      <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
      <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div id="userPanel" style="display:none;">
      <h2>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</h2>
      <pre id="me"></pre>
      <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
      <div id="stats"></div>
    </div>
  </div>

<script>
async function login(){
  const phone = document.getElementById("phone").value;
  const res = await fetch("/api/login", {
    method:"POST", headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ phone, role:"user" })
  });
  if(res.ok){
    document.getElementById("loginForm").style.display="none";
    document.getElementById("userPanel").style.display="block";
    loadMe();
    loadStats();
    setInterval(loadStats, 10000);
  } else {
    alert("ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
  }
}

async function loadMe(){
  const res = await fetch("/me");
  if(res.ok){
    const d = await res.json();
    document.getElementById("me").textContent = JSON.stringify(d, null, 2);
  }
}

async function loadStats(){
  const res = await fetch("/me/stats");
  if(res.ok){
    const d = await res.json();
    let html = `
      <p>ğŸ“¡ Ø§Ù„Ø­Ø§Ù„Ø©: ${d.connectionStatus}</p>
      <p>â±ï¸ Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: ${Math.floor(d.uptimeSeconds/60)} Ø¯Ù‚ÙŠÙ‚Ø©</p>
      <p>âœ‰ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©: ${d.sentMessages}</p>
      <p>ğŸ”— Webhook: <code>${d.webhookUrl}</code></p>
    `;
    if(d.qrImage){
      html += `<div class="qr"><img src="${d.qrImage}" width="200"></div>`;
    }
    document.getElementById("stats").innerHTML = html;
  }
}
</script>
</body>
</html>
